var EasyChef=EasyChef||{globalVars:{getUserDataUrl:"/api/Users/{0}",createNewUserUrl:"/api/Users",authenticationCookieName:"authentication",userCheckCookieName:"UserCheck",cartCookieName:"Cart",welcomeMessage:"Howdy, {0}",cartEmptyMessage:"Oh no, Cart is Empty!",orderSubmitMessage:"This will submit the order. Click OK to continue"},ChifuMessages:{cartdictionary:["Well, that's a smart choice","You're one in mellon","I prepared this meal specially for you"],greetingDictionary:["Howdy, people of Texas","Rise and shine","You forgot your apron Chef!","Let's make something awesome today"]},init:function(){EasyChef.Utility.positionFooter();EasyChef.Cart.updateCartBadgeCount()},Checkout:{fetchUserData:function(){var n=JSON.parse(EasyChef.Utility.readCookie(EasyChef.globalVars.authenticationCookieName));n!=null&&n.UserExist&&(console.log("Render user address details"),EasyChef.Checkout.showUserDetails(n))},showUserDetails:function(){},performUserDataUpdate:function(){if($("#shippingform").valid()){var n=JSON.parse(EasyChef.Utility.readCookie(EasyChef.globalVars.authenticationCookieName));n!=null&&($("#saveinfo").is(":checked")?(n.first_name=$(".fname").val(),n.last_name=$(".lname").val(),n.UserPhone=$(".phone").val(),n.UserAddress=$(".address").val(),n.UserEmail=$(".email").val(),n.DBSyncRequired=!0):n!=null&&(n.DBSyncRequired=!1),EasyChef.Utility.createCookie(EasyChef.globalVars.authenticationCookieName,JSON.stringify(n),7));window.location.href="/payment"}}},Payment:{showPaymentDetails:function(){var n=EasyChef.Utility.readCookie(EasyChef.globalVars.authenticationCookieName),t;n!=null&&(n=JSON.parse(n),t=n.PaymentInfo,t!=null&&($(".cardnumber").val(t.cardNumber),$(".cardexpiration").val(t.expirationDate)))},completeOrder:function(){var n,t,i;$("#paymentform").valid()&&confirm(EasyChef.globalVars.orderSubmitMessage)&&(n=JSON.parse(EasyChef.Utility.readCookie(EasyChef.globalVars.authenticationCookieName)),n!=null?n.DBSyncRequired==!0?(t={},t.type="CC",t.cardNumber=$(".cardnumber").val(),t.expirationDate=$(".cardexpiration").val(),n.PaymentInfo=t,n.UserId!=null?(i=EasyChef.Utility.createUserObject(n,!0),EasyChef.Utility.makeAjax(EasyChef.Utility.format(EasyChef.globalVars.getUserDataUrl,i.UserId),"PUT",JSON.stringify(i),function(){console.log("User data successfully updated to db");EasyChef.Utility.createCookie(EasyChef.globalVars.authenticationCookieName,JSON.stringify(n),7);window.location.href="/ordercomplete"},function(){console.log("Error in updating user data");window.location.href="/error/500"})):(i=EasyChef.Utility.createUserObject(n,!1),EasyChef.Utility.makeAjax(EasyChef.globalVars.createNewUserUrl,"POST",JSON.stringify(i),function(t){console.log("User succesfully created");n.UserExist=!0;n.DBSyncRequired=!1;n.UserId=t.id;EasyChef.Utility.createCookie(EasyChef.globalVars.authenticationCookieName,JSON.stringify(n),7);window.location.href="/ordercomplete"},function(n){console.log("Error in adding user data"+n);window.location.href="/error/500?code="+n.errorText}))):window.location.href="/ordercomplete?type=updatenotrequired":window.location.href="/ordercomplete?type=guest")}},Cart:{addItem:function(){this.addItemToCookie();this.updateCartBadgeCount();EasyChef.Utility.funnyMessage(EasyChef.ChifuMessages.cartdictionary)},updateCartBadgeCount:function(){var n=JSON.parse(EasyChef.Utility.readCookie("Cart"));n!=null?n.length>0?($(".badge").text(n.length),$(".badge").addClass("active"),$(".badge").removeClass("hide"),$(".cart").addClass("active")):($(".badge").text(""),$(".badge").addClass("hide"),$(".badge").removeClass("active"),$(".cart").removeClass("active")):($(".badge").text(""),$(".badge").addClass("hide"),$(".badge").removeClass("active"),$(".cart").removeClass("active"))},addItemToCookie:function(){var t,i,n;EasyChef.Utility.readCookie("Cart")!=null?(n=JSON.parse(EasyChef.Utility.readCookie("Cart")),t=EasyChef.Utility.getJSONObject(n,"RecipeName",$(".recipename").text()),t.length>0?t[0].Quantity=parseInt(t[0].Quantity)+1:n.push(this.getNewCartItem()),EasyChef.Utility.createCookie("Cart",JSON.stringify(n),30)):(i={},n=[],i.items=n,i.items.push(this.getNewCartItem()),EasyChef.Utility.createCookie("Cart",JSON.stringify(i.items),30))},getNewCartItem:function(){var n={};return n.RecipeName=$(".recipename").text(),n.Description=$(".shortdescription").text().substring(0,75)+"...",n.Price=$("#recipeprice").val(),n.Quantity=1,n},generateCartView:function(){var t=JSON.parse(EasyChef.Utility.readCookie("Cart")),n;t.length>0?(n="",$.each(t,function(t,i){n+=EasyChef.Cart.generateCartProductHTML(i)}),$("#cart tbody").html(n),this.updateCartTotal(),this.bindCartEvents(),$("#cart").removeClass("hide")):$(".container").html("<h2 class='text-center'>"+EasyChef.globalVars.cartEmptyMessage+"<\/h2>")},generateCartProductHTML:function(n){return"<tr><td data-th='Product'><div class='row'><div class='col-sm-12'><h4 class='nomargin recipename'>"+n.RecipeName+"<\/h4 ><p>"+n.Description+"<\/p><\/div ><\/div><\/td><td data-th='Price' class='itemprice'>$"+n.Price+"<\/td><td data-th='Quantity'><input type='number' class='form-control text-center' value='"+n.Quantity+"'><\/td><td data-th='Subtotal' class='text-center subtotal'>$"+n.Quantity*n.Price+"<\/td><td class='actions data-th=''><button class='btn btn-danger btn-block'><i class='fa fa-trash'><\/i><\/button><\/td><\/tr>"},bindCartEvents:function(){$(document).on("keyup mouseup","#cart tbody td input[type='number']",function(){var t=isNaN(parseFloat($(this).val()))?0:parseFloat($(this).val());$(this).parent().parent().find(".subtotal").text("$"+t*parseFloat($(this).parent().parent().find(".itemprice").text().replace("$","")));var n=JSON.parse(EasyChef.Utility.readCookie("Cart")),i=$(this).parent().parent().find(".recipename").text(),r=EasyChef.Utility.getJSONObject(n,"RecipeName",i);r[0].Quantity=parseInt($(this).val());EasyChef.Utility.createCookie("Cart",JSON.stringify(n),30);EasyChef.Cart.updateCartTotal()});$(document).on("click","table button",function(){var i=$(this).parent().parent().find(".recipename").text(),n,t;confirm("Do you want to delete "+$(this).parent().parent().find(".recipename").text()+"?")?($(this).parent().parent().remove(),n=JSON.parse(EasyChef.Utility.readCookie("Cart")),t=EasyChef.Utility.getJSONObject(n,"RecipeName",i),n.splice($.inArray(t,n),1),EasyChef.Utility.createCookie("Cart",JSON.stringify(n),30),n.length==0&&EasyChef.Cart.generateCartView(),EasyChef.Cart.updateCartBadgeCount()):EasyChef.Utility.funnyMessage(["Smart choice Chef! I bet you won't regret it."]);EasyChef.Cart.updateCartTotal()})},updateCartTotal:function(){var n=0;$.each($("#cart tbody tr td[data-th='Subtotal']"),function(){n+=parseFloat($(this).text().replace("$",""))});$("#cart .carttotal").text("$"+n)}},Facebook:{init:function(){FB.getLoginStatus(function(n){n.status==="connected"?(console.log("Logged In!"),EasyChef.Facebook.getFbUserData()):(console.log("User is not logged in."),EasyChef.Utility.readCookie(EasyChef.globalVars.authenticationCookieName)!=null&&EasyChef.Utility.deleteCookie(EasyChef.globalVars.authenticationCookieName),EasyChef.Utility.manageNavAfterLogout(),EasyChef.Utility.getPageName()=="login"&&($("#userData").addClass("hide"),$("#status").addClass("hide")))})},login:function(){FB.login(function(n){n.authResponse?getFbUserData():document.getElementById("status").innerHTML="User cancelled login or did not fully authorize."},{scope:"public_profile,email"})},getFbUserData:function(){FB.api("/me",{locale:"en_US",fields:"id,first_name,last_name,email,link,gender,locale,picture"},function(n){console.log("Fetching user data");$(".login").remove();EasyChef.Utility.createWelcome(n.first_name);var t=$("<li class='nav-item login'><a class='nav-link' onclick='EasyChef.Facebook.logout()' href='#'><span>Logout<\/span><\/a><\/li >");$("#rightnav li:eq(0)").after(t);EasyChef.Utility.checkAuthorization(n)})},logout:function(){FB.getLoginStatus(function(n){n.status=="connected"&&FB.logout(function(){return EasyChef.Utility.manageNavAfterLogout(),console.log("User logged out!"),!1})})}},Utility:{createUserObject:function(n,t){var i={};return t&&(i.UserId=n.UserId),i.UserFname=n.first_name,i.UserLname=n.last_name,i.UserEmail=n.UserEmail,i.UserAddress=n.UserAddress,i.RoleId=n.UserRole=="Admin"?1:2,i.UserFbId=n.fbid,i.UserPhone=n.UserPhone,n.PaymentId!=null&&(i.PaymentId=n.PaymentId),i.Payment=n.PaymentInfo,i},makeAjax:function(n,t,i,r,u){$.ajax({url:n,data:i,type:t,success:function(n){r(n)},headers:{Accept:"application/json","Content-Type":"application/json"},error:function(n){u(n)}})},positionFooter:function(){var t=0,i=0,n=$(".footer");t=n.height();i=$(window).scrollTop()+$(window).height()-t+"px";$(document.body).height()+t<$(window).height()?n.css({position:"absolute",top:i}):n.css({position:"static"});n.removeClass("hide");$(window).scroll(this.positionFooter).resize(this.positionFooter)},getQueryStringValue:function(n){for(var i=[],t,u=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<u.length;r++)t=u[r].split("="),i.push(t[0]),i[t[0]]=t[1];return i[n]},setLocalStorage:function(n,t){window.localStorage&&localStorage.setItem(n,t)},getLocalStorage:function(n){if(EasyChef.Utility.isLocalStorageKeyExist(n))return localStorage.getItem(n)},isLocalStorageKeyExist:function(n){var t=!1;return localStorage.getItem(n)!=null&&(t=!0),t},getJSONObject:function(n,t,i){var r=[];for(var u in n)n.hasOwnProperty(u)&&(typeof n[u]=="object"?r=r.concat(EasyChef.Utility.getJSONObject(n[u],t,i)):u==t&&n[t]==i&&r.push(n));return r},getPageName:function(){return location.pathname.split("/").slice(-1)[0].toLowerCase()},createCookie:function(n,t,i){var u,r;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString()):u="";document.cookie=encodeURIComponent(n)+"="+encodeURIComponent(t)+u+"; path=/"},readCookie:function(n){for(var t,r=encodeURIComponent(n)+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1,t.length);if(t.indexOf(r)===0)return decodeURIComponent(t.substring(r.length,t.length))}return null},deleteCookie:function(n){EasyChef.Utility.createCookie(n,"",-1)},format:function(n,t){return t=typeof t=="object"?t:Array.prototype.slice.call(arguments,1),n.replace(/\{\{|\}\}|\{(\w+)\}/g,function(n,i){return n=="{{"?"{":n=="}}"?"}":t[i]})},checkAuthorization:function(n){this.readCookie(EasyChef.globalVars.authenticationCookieName)==null&&EasyChef.Utility.makeAjax(this.format(EasyChef.globalVars.getUserDataUrl,n.id),"GET","",function(t){var i={};i.fbid=n.id;i.first_name=n.first_name;i.DBSyncRequired=!1;t==""?(i.UserRole="User",i.UserExist=!1):(i.UserRole=t.roleName,i.UserAddress=t.userAddress,i.UserEmail=t.userEmail,i.PaymentInfo=t.payment,i.PaymentId=t.paymentId,i.first_name=t.userFname,i.last_name=t.userLname,i.UserPhone=t.userPhone,i.UserExist=!0,i.UserId=t.userId);i.UserRole=="Admin"&&EasyChef.Utility.createAdminNav();EasyChef.Utility.createCookie(EasyChef.globalVars.authenticationCookieName,EasyChef.Utility.createJSON(i),7);console.log(t);window.location.href=EasyChef.Utility.getPageName()=="checkouttype"?"/checkout":"/"},function(n){console.log(n)})},createJSON:function(n){return JSON.stringify(n)},createAdminNav:function(){if($("#adminnav").length==0){var n=$("<li id='adminnav' class='nav-item'><a class='nav-link' href='/admin/recipe'><span>Admin<\/span><\/a><\/li>");$("#rightnav li:eq(1)").after(n)}},setNavActive:function(n){$(".navbar li.active").removeClass("active");n==""?(n=EasyChef.Utility.getPageName(),$(".navbar ."+n).addClass("active")):$(".navbar #"+n).addClass("active")},createWelcome:function(n){if($(".userwelcome").length==0){var t="<li class='nav-item userwelcome'><a href='#'><span>"+EasyChef.Utility.format(EasyChef.globalVars.welcomeMessage,n)+"!<\/span><\/a><\/li>";$("#rightnav").prepend(t)}},manageNavAfterLogout:function(){$(".login a").prop("href","/login");$(".login a").prop("onclick",null).off("click");$(".login span").text("Login");$("#adminnav")&&$("#adminnav").remove();$(".userwelcome")&&$(".userwelcome").remove();EasyChef.Facebook.init()},showSnackBar:function(){var n=$("#snackbar");n.addClass("show");setTimeout(function(){n.removeClass("show")},5e3)},funnyMessage:function(n){var t=n[Math.floor(Math.random()*n.length)];t="Chef Chifu - '"+t+"'";$("#snackbar").text(t);EasyChef.Utility.showSnackBar()}}};$(function(){EasyChef.init()});